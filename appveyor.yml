os: Visual Studio 2015
environment:
  global:
    PACKAGE_NAME: twitchdl
    BIN_NAME: twitchdl,m3u8
  matrix:
    - TARGET: x86_64-pc-windows-msvc
      CHANNEL: beta
    - TARGET: i686-pc-windows-msvc
      CHANNEL: beta

skip_tags: true
branches:
  only:
    - master

cache:
  - target
  - '%USERPROFILE%\.cargo'

install:
  - appveyor DownloadFile https://win.rustup.rs/ -FileName rustup-init.exe
  - rustup-init -yv --default-toolchain %channel% --default-host %target%
  - set PATH=%PATH%;%USERPROFILE%\.cargo\bin
  - rustc -vV
  - cargo -vV

build_script:
  - cargo build --all
  - cargo build --all --release

before_deploy:
  - ps: .\ci\before_deploy.ps1

after_build:
  - ps: .\ci\before_cache.ps1

deploy:
  release: "%RELEASE_NAME%"
  description: 'Automatically generated by Travis CI and AppVeyor'
  draft: false
  prerelease: true
  skip_cleanup: true
  provider: GitHub
  artifact: /.*\.zip/
  auth_token:
    secure: uN3rEJNowrv0VDqIhMw9T8YQUCp1jDP2T0hTXf8F4MB/s2p19NPaip29uVju+QRM
  on:
    branch: master
    APPVEYOR_REPO_TAG: false