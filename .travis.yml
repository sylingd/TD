sudo: required
env:
  global:
    - CRATE_NAME=twitchdl
os:
  - linux
  - windows
language: rust
rust:
  - beta

notifications:
  email: false

cache:
  - cargo

before_cache:
  - cargo clean -p $CRATE_NAME

before_install:
  - rustc -Vv
  - cargo -V

script:
  - cargo build
  - cargo build --release

after_success:
  - files=$(ls target/release)
  - echo $files

before_deploy:
  - export RELEASE_NAME=$(echo $TRAVIS_COMMIT | cut -c 1-16)
  - git tag $RELEASE_NAME

deploy:
  name: $RELEASE_NAME
  body: Automatically generated by Travis CI
  prerelease: true
  provider: releases
  skip_cleanup: true
  api_key:
    secure: GXyK0XMxp/d7QmpnkPb6Ltacb9BSgK8cFU46dELfQF7Xn7h76XBlOjjUZAm/FqJopkLV/qpLjumvztYF+Zy3NLromhDkWazc7lSum3aJ86cuJBJTQrwH27qZqsIiz8QtYJIOBXIttTE5PCdPsyr3/KFmVcyRTAnTd+ORjPNTAJKOMwVW3PQwVOP2r+Gnxap0NACkwLwmW5xBTMhOGsyA/McnC19cYG7782IPMgLcvnNMbshfT5HL204XZxZeysvVJBApJ4G+hTUaYkgylc32oOtF0QNQbE2hG+PMmbzE+HqJwa9YeH+5RmrvL+hLbNMYcFNGwnJ+y4QA82qIdWtvgxpOW8+WuQUh6oiOCTD4yglsrRHKNpg5n2sSBqnvPslwM0feQ5aMZZWNxLeSFlTiQVMrY777od+aQh6sKaFLEg7OrSo1KEkDL4IgqOSlnyp9Cd5i+f+t8NJjcvrU9yBUe6JmO1AaSObIgX5BEB9u7kSWRnbjX5mU1ROlhfDbjcV4fEKeB+zzb/VYmclXMpehGmsH7hU16taU0MMS1FFClj9LD7M0bqCGRfkyUtB1jImp2uEELXJMjQCbGmZz19SnDTjFKSe7zwQYsgpntx5uNMSQD2WjHPl6/SQpADA1BYsH4hIInwjjL56SsV312KWgqSoxFNrtkgHNw28ZGky5Yfg=
  file:
    - target/release/$CRATE_NAME.exe
    - target/release/$CRATE_NAME
  on:
    repo: sylingd/TD
    tags: false